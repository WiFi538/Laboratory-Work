// 1. Даны целочисленная матрица Z[1:n, 1:m] и целочисленный массив X[1:k]. 
// В каждой строке матрицы Z обнулить максимальный по абсолютной величине элемент, если его нет в массиве X.

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>
 
int main() {
    int n, m, k;
    char input[100];
 
    //Вывод заголовка программы
    printf("Лабораторная работа №\n");
    // Запрос размеров матрицы Z (n, m)
    printf("Введите размеры матрицы Z (n, m): ");
    while (1) {
        if (fgets(input, sizeof(input), stdin) != NULL) { //Считываем строку с вводом
            if (sscanf(input, "%d %d", &n, &m) == 2) { //Преобразуем строку в два целых числа
                if (n > 0 && m > 0) { //Проверка на положительность размеров
                    break; //Выход из цикла, если размеры корректны
                } else {
                    printf("Ошибка: размеры матрицы должны быть положительными числами. Повторите ввод: ");
                }
            } else {
                printf("Неверный ввод. Пожалуйста, введите два целых положительных числа: ");
            }
        }
    }
 
    // Запрос размера массива X (k)
    printf("Введите размер массива X (k): ");
    while (1) {
        if (fgets(input, sizeof(input), stdin) != NULL) { //Считываем строку с вводом
            if (sscanf(input, "%d", &k) == 1) { //Преобразуем строку в целое число
                if (k > 0) { //Проверка на положительность размера
                    break; //Выход из цикла, если размер корректен
                } else {
                    printf("Ошибка: размер массива должен быть положительным числом. Повторите ввод: ");
                }
            } else {
                printf("Неверный ввод. Пожалуйста, введите целое положительное число: ");
            }
        }
    }
 
    //Выделение памяти для матрицы Z
    int **Z = (int **)malloc(n * sizeof(int *));
    for (int i = 0; i < n; i++) {
        Z[i] = (int *)malloc(m * sizeof(int));
    }
 
    //Выделение памяти для массива X
    int *X = (int *)malloc(k * sizeof(int));
 
    //Запрос элементов матрицы Z
    printf("Введите элементы матрицы Z:\n");
    for (int i = 0; i < n; i++) {
        for (int j = 0; j < m; j++) {
            while (1) {
                if (fgets(input, sizeof(input), stdin) != NULL) { //Считываем строку с вводом
                    if (sscanf(input, "%d", &Z[i][j]) == 1) { //Преобразуем строку в целое число
                        break; //Выход из цикла, если ввод корректен
                    } else {
                        printf("Неверный ввод. Пожалуйста, введите целое число: ");
                    }
                }
            }
        }
    }
 
    //Запрос элементов массива X
    printf("Введите элементы массива X:\n");
    for (int i = 0; i < k; i++) {
        while (1) {
            if (fgets(input, sizeof(input), stdin) != NULL) { //Считываем строку с вводом
                if (sscanf(input, "%d", &X[i]) == 1) { //Преобразуем строку в целое число
                    break; //Выход из цикла, если ввод корректен
                } else {
                    printf("Неверный ввод. Пожалуйста, введите целое число: ");
                }
            }
        }
    }
 
    // Логика для обнуления максимального по абсолютной величине элемента в каждой строке матрицы Z, если его нет в массиве X
    for (int i = 0; i < n; i++) { //Цикл по строкам матрицы Z
        int maxAbsIndex = 0; //Индекс максимального по абсолютной величине элемента в текущей строке
        for (int j = 1; j < m; j++) { //Цикл по столбцам матрицы Z
            if (abs(Z[i][j]) > abs(Z[i][maxAbsIndex])) { //Если текущий элемент больше по абсолютной величине
                maxAbsIndex = j; //Обновляем индекс максимального элемента
            }
        }
        int maxAbsValue = Z[i][maxAbsIndex]; //Значение максимального по абсолютной величине элемента
        int found = 0; //Флаг, указывающий, найден ли элемент в массиве X
        for (int l = 0; l < k; l++) { //Цикл по элементам массива X
            if (X[l] == maxAbsValue) { //Если элемент найден в массиве X
                found = 1; //Устанавливаем флаг
                break; //Выходим из цикла
            }
        }
        if (!found) { //Если элемент не найден в массиве X

            Z[i][maxAbsIndex] = 0; //Обнуляем его
        }
    }
 
    //Вывод результата
    printf("Результат:\n");
    for (int i = 0; i < n; i++) {
        for (int j = 0; j < m; j++) {
            printf("%d ", Z[i][j]);
        }
        printf("\n");
    }
 
    //Освобождение памяти, выделенной для матрицы Z
    for (int i = 0; i < n; i++) {
        free(Z[i]);
    }
    free(Z);
 
    //Освобождение памяти, выделенной для массива X
    free(X);
 
    return 0;
}
